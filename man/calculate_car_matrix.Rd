% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_car_matrix.R
\name{calculate_car_matrix}
\alias{calculate_car_matrix}
\title{Calculate CAR Matrix with Bidirectional Element Changes}
\usage{
calculate_car_matrix(
  csv_file,
  db_path = "FTICR_CAR_smart.db",
  car_min = 0.45,
  car_max = 1,
  track_direction = TRUE,
  small_molecules = c("C", "O", "CH2", "H2O", "CO", "O2", "CO2", "NH3", "NH"),
  export_top = TRUE,
  top_n = 50,
  top_output_file = "Top50_formula.csv",
  export_all_summary = TRUE,
  all_summary_file = "All_formula_summary.csv",
  verbose = TRUE
)
}
\arguments{
\item{csv_file}{Character. Path to the input CSV file containing molecular formulas}

\item{db_path}{Character. Path to the SQLite database file (default: "FTICR_CAR_smart.db")}

\item{car_min}{Numeric. Minimum CAR threshold (default: 0.45)}

\item{car_max}{Numeric. Maximum CAR threshold (default: 1.0)}

\item{track_direction}{Logical. Whether to track element addition (+) or removal (-) (default: TRUE)}

\item{small_molecules}{Character vector. Molecules to be filtered out (default: predefined list)}

\item{export_top}{Logical. Whether to export top formulas to CSV (default: TRUE)}

\item{top_n}{Integer. Number of top formulas to export (default: 50)}

\item{top_output_file}{Character. Output file name for top formulas (default: "Top50_formula.csv")}

\item{export_all_summary}{Logical. Whether to export all formula statistics (default: TRUE)}

\item{all_summary_file}{Character. Output file name for all statistics (default: "All_formula_summary.csv")}

\item{verbose}{Logical. Whether to print progress messages (default: TRUE)}
}
\value{
A list containing:
\itemize{
  \item{db_connection: }{SQLite database connection object}
  \item{formula_summary: }{Data frame of formula frequency statistics}
  \item{top_n_formulas: }{Top N most frequent formulas}
  \item{stats: }{Summary statistics}
}
}
\description{
This function performs CAR (Carbon Aromaticity Ratio) matrix calculation,
filters molecular formulas, and generates frequency statistics.
Enhanced version that calculates both directions of transformations since
mass spectrometry reactions are bidirectional.
Supports C, H, O, N, S, and P elements.
}
\examples{
\dontrun{
# Basic usage with bidirectional tracking
result <- calculate_car_matrix("merged_molform_elements.csv")

# Without directional tracking (absolute differences only)
result <- calculate_car_matrix(
  csv_file = "data.csv",
  track_direction = FALSE
)
}
}
